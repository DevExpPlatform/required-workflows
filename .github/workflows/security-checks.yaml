on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]
  workflow_dispatch:
    inputs:
      scan-branch:
        description: "Branch to scan"
        required: false
        default: "main"
        type: string
      runner:
        description: "Runner to use"
        required: false
        default: "ubuntu-latest"
        type: string

# workflow or job level
permissions:
  contents: read
  security-events: read
  checks: read
  # pull request summaries
  pull-requests: write

jobs:
  compliance:
    runs-on: ${{ inputs.runner }}
    steps:
      - name: Advance Security Policy as Code
        uses: advanced-security/policy-as-code@v2.9.0
        with:
          # The owner/repo of where the policy is stored
          policy: DevExpPlatform/required-workflows
          # The local (within the workspace) or repository
          policy-path: policies/default.yaml
          # The branch you want to target
          policy-branch: main
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: ${{ inputs.scan-branch }}
